kind: pipeline
name: default

steps:
- name: builder
  image: ubuntu:19.04
  environment:
    VERSION: 18.06
    FORCE_UNSAFE_CONFIGURE: 1
  commands:
  - apt update
  - apt install -y git build-essential libncurses5-dev python unzip gawk wget
  - mkdir -p /data/lede
  - cd /data/lede
  - git clone https://github.com/openwrt/openwrt.git
  - cd openwrt/
  - git checkout openwrt-$VERSION
  - ./scripts/feeds update -a
  - ./scripts/feeds install -a
  - make defconfig
  - make download -j $(getconf _NPROCESSORS_ONLN)
  - make -j $(getconf _NPROCESSORS_ONLN)  V=s
  #- make -j1 V=s
  volumes:
  - name: cache
    path: /cache
